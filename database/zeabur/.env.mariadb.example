# MariaDB 11.3.2 環境變數配置 (Zeabur 版本)
# 此檔案包含 MariaDB 容器的所有環境變數設定

# ===========================================
# 基本資料庫設定
# ===========================================
MYSQL_DATABASE=rosca_db
MYSQL_USER=rosca_user
MYSQL_PASSWORD=RoscaSecure2024!@#
MYSQL_ROOT_PASSWORD=RootSecure2024!@#$

# ===========================================
# 字符集和排序規則
# ===========================================
MYSQL_CHARACTER_SET_SERVER=utf8mb4
MYSQL_COLLATION_SERVER=utf8mb4_general_ci

# ===========================================
# 時區設定
# ===========================================
TZ=Asia/Taipei

# ===========================================
# MariaDB 特定設定
# ===========================================
# 允許空密碼 (生產環境應設為 no)
MYSQL_ALLOW_EMPTY_PASSWORD=no

# 隨機 root 密碼 (如果不想指定 root 密碼)
# MYSQL_RANDOM_ROOT_PASSWORD=yes

# 初始化資料庫時移除匿名用戶
MYSQL_REMOVE_ANONYMOUS_USERS=yes

# 初始化資料庫時移除測試資料庫
MYSQL_REMOVE_TEST_DATABASE=yes

# ===========================================
# 連接和性能設定
# ===========================================
# 最大連接數
MYSQL_MAX_CONNECTIONS=100

# 連接超時
MYSQL_CONNECT_TIMEOUT=10

# 等待超時
MYSQL_WAIT_TIMEOUT=28800

# 互動超時
MYSQL_INTERACTIVE_TIMEOUT=28800

# ===========================================
# 記憶體配置 (適合 Zeabur 512MB-1GB 限制)
# ===========================================
# InnoDB 緩衝池大小
MYSQL_INNODB_BUFFER_POOL_SIZE=128M

# InnoDB 日誌檔案大小
MYSQL_INNODB_LOG_FILE_SIZE=32M

# InnoDB 日誌緩衝區大小
MYSQL_INNODB_LOG_BUFFER_SIZE=8M

# 查詢緩存大小
MYSQL_QUERY_CACHE_SIZE=16M

# 臨時表大小
MYSQL_TMP_TABLE_SIZE=32M

# 最大堆表大小
MYSQL_MAX_HEAP_TABLE_SIZE=32M

# ===========================================
# 日誌設定
# ===========================================
# 慢查詢日誌
MYSQL_SLOW_QUERY_LOG=1
MYSQL_LONG_QUERY_TIME=2

# 錯誤日誌等級
MYSQL_LOG_ERROR_VERBOSITY=2

# 二進制日誌保留天數
MYSQL_EXPIRE_LOGS_DAYS=3

# ===========================================
# 安全設定
# ===========================================
# 禁用本地檔案載入
MYSQL_LOCAL_INFILE=0

# 跳過域名解析
MYSQL_SKIP_NAME_RESOLVE=1

# SQL 模式
MYSQL_SQL_MODE=STRICT_TRANS_TABLES,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER

# ===========================================
# Zeabur 特定設定
# ===========================================
# 資料持久化目錄
MYSQL_DATADIR=/var/lib/mysql

# 配置檔案路徑
MYSQL_CONFIG_FILE=/etc/mysql/my.cnf

# 初始化腳本目錄
MYSQL_INITDB_DIR=/docker-entrypoint-initdb.d

# ===========================================
# 健康檢查設定
# ===========================================
# 健康檢查間隔 (秒)
HEALTHCHECK_INTERVAL=30

# 健康檢查超時 (秒)
HEALTHCHECK_TIMEOUT=10

# 健康檢查重試次數
HEALTHCHECK_RETRIES=3

# 健康檢查啟動期間 (秒)
HEALTHCHECK_START_PERIOD=60

# ===========================================
# 備份設定
# ===========================================
# 自動備份間隔 (小時)
BACKUP_INTERVAL=24

# 備份保留天數
BACKUP_RETENTION_DAYS=7

# 備份壓縮
BACKUP_COMPRESS=1

# ===========================================
# 監控設定
# ===========================================
# 啟用性能監控
PERFORMANCE_SCHEMA=ON

# 啟用慢查詢日誌
SLOW_QUERY_LOG=ON

# 記錄未使用索引的查詢
LOG_QUERIES_NOT_USING_INDEXES=OFF

# ===========================================
# 密碼安全要求
# ===========================================
# 資料庫密碼要求：
# - 至少 12 個字符
# - 包含大寫字母 (A-Z)
# - 包含小寫字母 (a-z)  
# - 包含數字 (0-9)
# - 包含特殊字符 (!@#$%^&*)
# - 不包含用戶名或常見詞彙
# - 定期更換 (建議每 90 天)

# ===========================================
# 部署注意事項
# ===========================================
# 1. 在 Zeabur 中設定這些環境變數時，請確保敏感資訊的安全性
# 2. MYSQL_ROOT_PASSWORD 和 MYSQL_PASSWORD 應使用強密碼
# 3. 在生產環境中，建議啟用 SSL/TLS 連接
# 4. 定期備份資料庫並測試恢復程序
# 5. 監控資料庫性能和資源使用情況
# 6. 設定適當的防火牆規則限制資料庫訪問